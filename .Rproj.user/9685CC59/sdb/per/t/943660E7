{
    "collab_server" : "",
    "contents" : "\n\ncheck_log <- function(path = \".\", final = FALSE, check_for_rerun_only = FALSE, .report_error){\n  if (missing(.report_error)){\n    .report_error <- function(...) report2console(...)\n  }\n  \n  log_files <- dir(path = path, pattern = \"\\\\.log$\", full.names = TRUE)\n  if (length(log_files) != 1){\n    stop(\"Path does not contain a single log file.\")\n  }\n\n  log_file <- read_lines(log_files[[1]])\n  \n  if (FALSE){\n  file_list_start <- grep(\"*File List*\", log_file, fixed = TRUE)\n  stars <- grep(\"***********\", log_file, fixed = TRUE)\n  file_list_stop <- min(stars[stars > file_list_start])\n  \n  file_list <- log_file[file_list_start:file_list_stop]\n  \n  # >\"  keyval.sty    2014/10/28 v1.15 key=value parser (DPC)\"<\n  file_list_pattern <- \"^\\\\s*([a-z]+\\\\.(?:(?:cls)|(?:sty)))    ([12][0-9]{3}/[0-9]{2}/[0-9]{2}) (v?\\\\s?(?:er)?[0-9]+(?:\\\\.[0-9a-z]+)?)?.*$\"\n  \n  file_list_grep <- grep(file_list_pattern, file_list, value = TRUE, perl = TRUE)\n  \n  file_tbl <- \n    data.table(package = gsub(file_list_pattern, \"\\\\1\", file_list_grep, perl = TRUE),\n               date = as.Date(gsub(file_list_pattern, \"\\\\2\", file_list_grep, perl = TRUE), format = \"%Y/%m/%d\"),\n               version = gsub(file_list_pattern, \"\\\\3\", file_list_grep, perl = TRUE))\n  }\n\n  if (any(grepl(\"undefined references\", log_file, fixed = TRUE))){\n    which_line <- grep(\"undefined references\", log_file, fixed = TRUE)\n    cat(which_line, \"\\n\", log_files[which_line])\n    .report_error(error_message = \"Undefined cross-references.\", \n                  advice = \"Check each use of Vref and Cref and that it contains a valid \\\\label.\")\n    stop(\"Undefined references.\")\n  }\n\n  if (any(grepl(\"LaTeX Warning: There were multiply-defined labels.\", log_file, fixed = TRUE))){\n    .report_error(error_message = \"Multiply-defined labels\",\n                  advice = \"You have used \\\\label{} with the same key more than once.\")\n    stop(\"LaTeX Warning: There were multiply-defined labels.\")\n  }\n  \n  if (any(or(grepl(\"LaTeX Warning: Label(s) may have changed. Rerun to get cross-references right.\",\n                   log_file,\n                   fixed = TRUE), \n             grepl(\"Please rerun LaTeX.\",\n                   log_file,\n                   fixed = TRUE)))){\n    if (check_for_rerun_only){\n      return(\"Rerun LaTeX.\")\n    } else {\n      stop(\"LaTeX Warning: Label(s) may have changed. Rerun to get cross-references right.\")\n    }\n  }\n\n  invisible(NULL)\n}\n",
    "created" : 1486479061792.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1805606891",
    "id" : "943660E7",
    "lastKnownWriteTime" : 1486554132,
    "last_content_update" : 1486554132707,
    "path" : "~/grattanReporter/R/check_log.R",
    "project_path" : "R/check_log.R",
    "properties" : {
    },
    "relative_order" : 22,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}